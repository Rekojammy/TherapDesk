(function(){"use strict";function n(){u.add("visualchars",function(n){var t=e(wn(n));return bn(n,t),Cn(n,t),An(n,t),kn(n,t),i(t)})}var t,r,o,e=function(n){var t=n,r=function(){return t},o=function(n){t=n};return{get:r,set:o}},u=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),i=function(n){var t=function(){return n.get()};return{isEnabled:t}},c=function(n,t){return n.fire("VisualChars",{state:t})},a=function(n){var t=typeof n;return null===n?"null":"object"===t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t},f=function(n){return function(t){return a(t)===n}},s=function(n){return function(t){return typeof t===n}},l=f("string"),d=s("boolean"),m=s("number"),v=function(){},g=function(n){return function(){return n}},h=function(n){return n},p=g(!1),y=g(!0),b=function(){return w},w=(t=function(n){return n()},r=h,o={fold:function(n,t){return n()},isSome:p,isNone:y,getOr:r,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:r,orThunk:t,map:b,each:v,bind:b,exists:p,forall:y,filter:function(){return b()},toArray:function(){return[]},toString:g("none()")},o),T=function(n){var t=g(n),r=function(){return e},o=function(t){return t(n)},e={fold:function(t,r){return r(n)},isSome:y,isNone:p,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:r,orThunk:r,map:function(t){return T(t(n))},each:function(t){t(n)},bind:o,exists:o,forall:o,filter:function(t){return t(n)?e:w},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return e},k=function(n){return null==n?w:T(n)},N={some:T,none:b,from:k},A=function(n,t){for(var r=n.length,o=new Array(r),e=0;e<r;e++){var u=n[e];o[e]=t(u,e)}return o},O=function(n,t){for(var r=0,o=n.length;r<o;r++){var e=n[r];t(e,r)}},C=function(n,t){for(var r=[],o=0,e=n.length;o<e;o++){var u=n[o];t(u,o)&&r.push(u)}return r},S=Object.keys,D=function(n,t){for(var r=S(n),o=0,e=r.length;o<e;o++){var u=r[o],i=n[u];t(i,u)}};"undefined"!=typeof window?window:Function("return this;")();var E=3,L=function(n){return n.dom.nodeType},x=function(n){return n.dom.nodeValue},B=function(n){return function(t){return L(t)===n}},P=B(E),V=function(n,t,r){if(!(l(r)||d(r)||m(r)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",r,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(t,r+"")},j=function(n,t,r){V(n.dom,t,r)},H=function(n,t){var r=n.dom.getAttribute(t);return null===r?void 0:r},M=function(n,t){n.dom.removeAttribute(t)},_=function(n,t){var r=H(n,t);return void 0===r||""===r?[]:r.split(" ")},F=function(n,t,r){var o=_(n,t),e=o.concat([r]);return j(n,t,e.join(" ")),!0},I=function(n,t,r){var o=C(_(n,t),function(n){return n!==r});return o.length>0?j(n,t,o.join(" ")):M(n,t),!1},R=function(n){return void 0!==n.dom.classList},U=function(n){return _(n,"class")},K=function(n,t){return F(n,"class",t)},q=function(n,t){return I(n,"class",t)},z=function(n,t){R(n)?n.dom.classList.add(t):K(n,t)},G=function(n){var t=R(n)?n.dom.classList:U(n);0===t.length&&M(n,"class")},J=function(n,t){if(R(n)){var r=n.dom.classList;r.remove(t)}else q(n,t);G(n)},Q=function(n,t){var r=t||document,o=r.createElement("div");if(o.innerHTML=n,!o.hasChildNodes()||o.childNodes.length>1)throw console.error("HTML does not have a single root node",n),new Error("HTML must have a single root node");return Y(o.childNodes[0])},W=function(n,t){var r=t||document,o=r.createElement(n);return Y(o)},X=function(n,t){var r=t||document,o=r.createTextNode(n);return Y(o)},Y=function(n){if(null==n)throw new Error("Node cannot be null or undefined");return{dom:n}},Z=function(n,t,r){return N.from(n.dom.elementFromPoint(t,r)).map(Y)},$={fromHtml:Q,fromTag:W,fromText:X,fromDom:Y,fromPoint:Z},nn={" ":"nbsp","­":"shy"},tn=function(n,t){var r="";return D(n,function(n,t){r+=t}),new RegExp("["+r+"]",t?"g":"")},rn=function(n){var t="";return D(n,function(n){t&&(t+=","),t+="span.mce-"+n}),t},on=tn(nn),en=tn(nn,!0),un=rn(nn),cn="mce-nbsp",an=function(n){return'<span data-mce-bogus="1" class="mce-'+nn[n]+'">'+n+"</span>"},fn=function(n){var t=x(n);return P(n)&&void 0!==t&&on.test(t)},sn=function(n,t){var r=[],o=n.dom,e=A(o.childNodes,$.fromDom);return O(e,function(n){t(n)&&(r=r.concat([n])),r=r.concat(sn(n,t))}),r},ln=function(n,t){for(;n.parentNode;){if(n.parentNode===t)return n;n=n.parentNode}},dn=function(n){return n.replace(en,an)},mn=function(n){return"span"===n.nodeName.toLowerCase()&&n.classList.contains("mce-nbsp-wrap")},vn=function(n,t){var r=sn($.fromDom(t),fn);O(r,function(t){var r=t.dom.parentNode;if(mn(r))z($.fromDom(r),cn);else{for(var o=dn(n.dom.encode(x(t))),e=n.dom.create("div",null,o),u=void 0;u=e.lastChild;)n.dom.insertAfter(u,t.dom);n.dom.remove(t.dom)}})},gn=function(n,t){var r=n.dom.select(un,t);O(r,function(t){mn(t)?J($.fromDom(t),cn):n.dom.remove(t,!0)})},hn=function(n){var t=n.getBody(),r=n.selection.getBookmark(),o=ln(n.selection.getNode(),t);o=void 0!==o?o:t,gn(n,o),vn(n,o),n.selection.moveToBookmark(r)},pn=function(n,t){c(n,t.get());var r=n.getBody();!0===t.get()?vn(n,r):gn(n,r)},yn=function(n,t){t.set(!t.get());var r=n.selection.getBookmark();pn(n,t),n.selection.moveToBookmark(r)},bn=function(n,t){n.addCommand("mceVisualChars",function(){yn(n,t)})},wn=function(n){return n.getParam("visualchars_default_state",!1)},Tn=function(n){return!1!==n.getParam("forced_root_block")},kn=function(n,t){n.on("init",function(){pn(n,t)})},Nn=tinymce.util.Tools.resolve("tinymce.util.Delay"),An=function(n,t){var r=Nn.debounce(function(){hn(n)},300);Tn(n)&&n.on("keydown",function(o){!0===t.get()&&(13===o.keyCode?hn(n):r())}),n.on("remove",r.stop)},On=function(n,t){return function(r){r.setActive(t.get());var o=function(n){return r.setActive(n.state)};return n.on("VisualChars",o),function(){return n.off("VisualChars",o)}}},Cn=function(n,t){var r=function(){return n.execCommand("mceVisualChars")};n.ui.registry.addToggleButton("visualchars",{tooltip:"Show invisible characters",icon:"visualchars",onAction:r,onSetup:On(n,t)}),n.ui.registry.addToggleMenuItem("visualchars",{text:"Show invisible characters",icon:"visualchars",onAction:r,onSetup:On(n,t)})};n()})();