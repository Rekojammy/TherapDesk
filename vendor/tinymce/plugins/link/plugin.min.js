(function(){"use strict";function t(){o.add("link",function(t){Mn(t),zn(t),jn(t),Vn(t),Dn(t),In(t),Kn(t)})}var n,e,r,o=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),i=tinymce.util.Tools.resolve("tinymce.util.VK"),u=function(t){var n=typeof t;return null===t?"null":"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n},a=function(t){return function(n){return u(n)===t}},c=function(t){return function(n){return typeof n===t}},l=function(t){return function(n){return t===n}},f=a("string"),s=a("array"),m=l(null),g=c("boolean"),d=c("function"),h=function(){},v=function(t){return function(){return t}},p=function(t){return t},k=function(t,n){return t===n},y=v(!1),x=v(!0),b=function(){return O},O=(n=function(t){return t()},e=p,r={fold:function(t,n){return t()},isSome:y,isNone:x,getOr:e,getOrThunk:n,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:v(null),getOrUndefined:v(void 0),or:e,orThunk:n,map:b,each:h,bind:b,exists:y,forall:x,filter:function(){return b()},toArray:function(){return[]},toString:v("none()")},r),w=function(t){var n=v(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},isSome:x,isNone:y,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return w(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:O},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},C=function(t){return null==t?O:w(t)},A={some:w,none:b,from:C},N=Array.prototype.indexOf,T=Array.prototype.push,P=function(t,n){return N.call(t,n)},R=function(t,n){return P(t,n)>-1},S=function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var i=t[o];r[o]=n(i,o)}return r},_=function(t,n){for(var e=0,r=t.length;e<r;e++){var o=t[e];n(o,e)}},D=function(t,n,e){return _(t,function(t,r){e=n(e,t,r)}),e},L=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!s(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);T.apply(n,t[e])}return n},E=function(t,n){return L(S(t,n))},U=function(t,n){for(var e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return A.none()},B=function(t,n,e){return void 0===e&&(e=k),t.exists(function(t){return e(t,n)})},I=function(t){for(var n=[],e=function(t){n.push(t)},r=0;r<t.length;r++)t[r].each(e);return n},K=function(t,n){return t?A.some(n):A.none()},M=function(t){var n=t.getParam("link_assume_external_targets",!1);return g(n)&&n?1:!f(n)||"http"!==n&&"https"!==n?0:n},z=function(t){return t.getParam("link_context_toolbar",!1,"boolean")},j=function(t){return t.getParam("link_list")},V=function(t){return t.getParam("default_link_target")},q=function(t){return t.getParam("target_list",!0)},F=function(t){return t.getParam("rel_list",[],"array")},W=function(t){return t.getParam("link_class_list",[],"array")},H=function(t){return t.getParam("link_title",!0,"boolean")},G=function(t){return t.getParam("allow_unsafe_link_target",!1,"boolean")},J=function(t){return t.getParam("link_quicklink",!1,"boolean")},X=function(t){return t.getParam("link_default_protocol","http","string")},$=tinymce.util.Tools.resolve("tinymce.util.Tools"),Q=function(t){return f(t.value)?t.value:""},Y=function(t){return f(t.text)?t.text:f(t.title)?t.title:""},Z=function(t,n){var e=[];return $.each(t,function(t){var r=Y(t);if(void 0!==t.menu){var o=Z(t.menu,n);e.push({text:r,items:o})}else{var i=n(t);e.push({text:r,value:i})}}),e},tt=function(t){return void 0===t&&(t=Q),function(n){return A.from(n).map(function(n){return Z(n,t)})}},nt=function(t){return tt(Q)(t)},et=function(t,n){return function(e){return{name:t,type:"listbox",label:n,items:e}}},rt={sanitize:nt,sanitizeWith:tt,createUi:et,getValue:Q},ot=function(){return ot=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e],n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t},ot.apply(this,arguments)},it=Object.keys,ut=Object.hasOwnProperty,at=function(t,n){for(var e=it(t),r=0,o=e.length;r<o;r++){var i=e[r],u=t[i];n(u,i)}},ct=function(t){return function(n,e){t[e]=n}},lt=function(t,n,e,r){var o={};return at(t,function(t,o){(n(t,o)?e:r)(t,o)}),o},ft=function(t,n){var e={};return lt(t,n,ct(e),h),e},st=function(t,n){return ut.call(t,n)},mt=function(t,n){return st(t,n)&&void 0!==t[n]&&null!==t[n]},gt=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),dt=tinymce.util.Tools.resolve("tinymce.util.URI"),ht=function(t){return t&&"a"===t.nodeName.toLowerCase()},vt=function(t){return ht(t)&&!!yt(t)},pt=function(t,n){if(t.collapsed)return[];var e=t.cloneContents(),r=new gt(e.firstChild,e),o=[],i=e.firstChild;do{n(i)&&o.push(i)}while(i=r.next());return o},kt=function(t){return/^\w+:/i.test(t)},yt=function(t){var n=t.getAttribute("data-mce-href");return n||t.getAttribute("href")},xt=function(t,n){var e=["noopener"],r=t?t.split(/\s+/):[],o=function(t){return $.trim(t.sort().join(" "))},i=function(t){return t=u(t),t.length>0?t.concat(e):e},u=function(t){return t.filter(function(t){return-1===$.inArray(e,t)})},a=n?i(r):u(r);return a.length>0?o(a):""},bt=function(t){return t.replace(/\uFEFF/g,"")},Ot=function(t,n){return n=n||t.selection.getNode(),Tt(n)?t.dom.select("a[href]",n)[0]:t.dom.getParent(n,"a[href]")},wt=function(t,n){var e=n?n.innerText||n.textContent:t.getContent({format:"text"});return bt(e)},Ct=function(t){return $.grep(t,vt).length>0},At=function(t){return pt(t,vt).length>0},Nt=function(t){var n=t.schema.getTextInlineElements(),e=function(t){return 1===t.nodeType&&!ht(t)&&!st(n,t.nodeName.toLowerCase())},r=pt(t.selection.getRng(),e);return 0===r.length},Tt=function(t){return t&&"FIGURE"===t.nodeName&&/\bimage\b/i.test(t.className)},Pt=function(t){var n=["title","rel","class","target"];return D(n,function(n,e){return t[e].each(function(t){n[e]=t.length>0?t:null}),n},{href:t.href})},Rt=function(t,n){return"http"!==n&&"https"!==n||kt(t)?t:n+"://"+t},St=function(t,n){var e=ot({},n);if(!(F(t).length>0)&&!1===G(t)){var r=xt(e.rel,"_blank"===e.target);e.rel=r||null}return A.from(e.target).isNone()&&!1===q(t)&&(e.target=V(t)),e.href=Rt(e.href,M(t)),e},_t=function(t,n,e,r){e.each(function(t){st(n,"innerText")?n.innerText=t:n.textContent=t}),t.dom.setAttribs(n,r),t.selection.select(n)},Dt=function(t,n,e,r){Tt(n)?jt(t,n,r):e.fold(function(){t.execCommand("mceInsertLink",!1,r)},function(n){t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n)))})},Lt=function(t,n,e){var r=t.selection.getNode(),o=Ot(t,r),i=St(t,Pt(e));t.undoReceptionist.transact(function(){e.href===n.href&&n.attach(),o?(t.focus(),_t(t,o,e.text,i)):Dt(t,r,e.text,i)})},Et=function(t){var n=t.dom,e=t.selection,r=e.getBookmark(),o=e.getRng().cloneRange(),i=n.getParent(o.startContainer,"a[href]",t.getBody()),u=n.getParent(o.endContainer,"a[href]",t.getBody());i&&o.setStartBefore(i),u&&o.setEndAfter(u),e.setRng(o),t.execCommand("unlink"),e.moveToBookmark(r)},Ut=function(t){t.undoReceptionist.transact(function(){var n=t.selection.getNode();Tt(n)?zt(t,n):Et(t),t.focus()})},Bt=function(t){var n=t.class,e=t.href,r=t.rel,o=t.target,i=t.text,u=t.title;return ft({class:n.getOrNull(),href:e,rel:r.getOrNull(),target:o.getOrNull(),text:i.getOrNull(),title:u.getOrNull()},function(t,n){return!1===m(t)})},It=function(t,n){var e=n.href;return ot(ot({},n),{href:dt.isDomSafe(e,"a",t.settings)?e:""})},Kt=function(t,n,e){var r=It(t,e);t.hasPlugin("rtc",!0)?t.execCommand("createlink",!1,Bt(r)):Lt(t,n,r)},Mt=function(t){t.hasPlugin("rtc",!0)?t.execCommand("unlink"):Ut(t)},zt=function(t,n){var e=t.dom.select("img",n)[0];if(e){var r=t.dom.getParents(e,"a[href]",n)[0];r&&(r.parentNode.insertBefore(e,r),t.dom.remove(r))}},jt=function(t,n,e){var r=t.dom.select("img",n)[0];if(r){var o=t.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},Vt=function(t){return mt(t,"items")},qt=function(t,n){return U(n,function(n){return Vt(n)?qt(t,n.items):K(n.value===t,n)})},Ft=function(t,n,e,r){var o=r[n],i=t.length>0;return void 0!==o?qt(o,e).map(function(n){return{url:{value:n.value,meta:{text:i?t:n.text,attach:h}},text:i?t:n.text}}):A.none()},Wt=function(t,n){return"link"===n?t.link:"anchor"===n?t.anchor:A.none()},Ht=function(t,n){var e={text:t.text,title:t.title},r=function(t){return K(e.title.length<=0,A.from(t.meta.title).getOr(""))},o=function(t){return K(e.text.length<=0,A.from(t.meta.text).getOr(t.value))},i=function(t){var n=o(t.url),e=r(t.url);return n.isSome()||e.isSome()?A.some(ot(ot({},n.map(function(t){return{text:t}}).getOr({})),e.map(function(t){return{title:t}}).getOr({}))):A.none()},u=function(t,r){var o=Wt(n,r.name).getOr([]);return Ft(e.text,r.name,o,t)},a=function(t,n){var r=n.name;return"url"===r?i(t()):R(["anchor","link"],r)?u(t(),n):"text"===r||"title"===r?(e[r]=t()[r],A.none()):A.none()};return{onChange:a}},Gt={init:Ht,getDelta:Ft},Jt=tinymce.util.Tools.resolve("tinymce.util.Delay"),Xt=tinymce.util.Tools.resolve("tinymce.util.Promise"),$t=function(t,n,e){var r=t.selection.getRng();Jt.setEditorTimeout(t,function(){t.windowReceptionist.confirm(n,function(n){t.selection.setRng(r),e(n)})})},Qt=function(t){var n=t.href,e=n.indexOf("@")>0&&-1===n.indexOf("/")&&-1===n.indexOf("mailto:");return e?A.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(t){return ot(ot({},t),{href:"mailto:"+n})}}):A.none()},Yt=function(t,n){return function(e){var r=e.href,o=1===t&&!kt(r)||0===t&&/^\s*www(\.|\d\.)/i.test(r);return o?A.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+n+":// prefix?",preprocess:function(t){return ot(ot({},t),{href:n+"://"+r})}}):A.none()}},Zt=function(t,n){return U([Qt,Yt(M(t),X(t))],function(t){return t(n)}).fold(function(){return Xt.resolve(n)},function(e){return new Xt(function(r){$t(t,e.message,function(t){r(t?e.preprocess(n):n)})})})},tn={preprocess:Zt},nn=function(t){var n=t.dom.select("a:not([href])"),e=E(n,function(t){var n=t.name||t.id;return n?[{text:n,value:"#"+n}]:[]});return e.length>0?A.some([{text:"None",value:""}].concat(e)):A.none()},en={getAnchors:nn},rn=function(t){var n=W(t);return n.length>0?rt.sanitize(n):A.none()},on={getClasses:rn},un=tinymce.util.Tools.resolve("tinymce.util.XHR"),an=function(t){try{return A.some(JSON.parse(t))}catch(t){return A.none()}},cn=function(t){var n=function(n){return t.convertURL(n.value||n.url,"href")},e=j(t);return new Xt(function(t){f(e)?un.send({url:e,success:function(n){return t(an(n))},error:function(n){return t(A.none())}}):d(e)?e(function(n){return t(A.some(n))}):t(A.from(e))}).then(function(t){return t.bind(rt.sanitizeWith(n)).map(function(t){if(t.length>0){var n=[{text:"None",value:""}];return n.concat(t)}return t})})},ln={getLinks:cn},fn=function(t,n){var e=F(t);if(e.length>0){var r=B(n,"_blank"),o=!1===G(t),i=function(t){return xt(rt.getValue(t),r)},u=o?rt.sanitizeWith(i):rt.sanitize;return u(e)}return A.none()},sn={getRels:fn},mn=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],gn=function(t){var n=q(t);return s(n)?rt.sanitize(n).orThunk(function(){return A.some(mn)}):!1===n?A.none():A.some(mn)},dn={getTargets:gn},hn=function(t,n,e){var r=t.getAttrib(n,e);return null!==r&&r.length>0?A.some(r):A.none()},vn=function(t,n){var e=t.dom,r=Nt(t),o=r?A.some(wt(t.selection,n)):A.none(),i=n?A.some(e.getAttrib(n,"href")):A.none(),u=n?A.from(e.getAttrib(n,"target")):A.none(),a=hn(e,n,"rel"),c=hn(e,n,"class"),l=hn(e,n,"title");return{url:i,text:o,title:l,target:u,rel:a,linkClass:c}},pn=function(t,n){return ln.getLinks(t).then(function(e){var r=vn(t,n);return{anchor:r,catalogs:{targets:dn.getTargets(t),rels:sn.getRels(t,r.target),classes:on.getClasses(t),anchor:en.getAnchors(t),link:e},optNode:A.from(n),flags:{titleEnabled:H(t)}}})},kn={collect:pn},yn=function(t,n){return function(e){var r=e.getData();if(!r.url.value)return Mt(t),void e.close();var o=function(t){return A.from(r[t]).filter(function(e){return!B(n.anchor[t],e)})},i={href:r.url.value,text:o("text"),target:o("target"),rel:o("rel"),class:o("linkClass"),title:o("title")},u={href:r.url.value,attach:void 0!==r.url.meta&&r.url.meta.attach?r.url.meta.attach:h};tn.preprocess(t,i).then(function(n){Kt(t,u,n)}),e.close()}},xn=function(t){var n=Ot(t);return kn.collect(t,n)},bn=function(t,n){var e=t.anchor,r=e.url.getOr("");return{url:{value:r,meta:{original:{value:r}}},text:e.text.getOr(""),title:e.title.getOr(""),anchor:r,link:r,rel:e.rel.getOr(""),target:e.target.or(n).getOr(""),linkClass:e.linkClass.getOr("")}},On=function(t,n,e){var r=[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],o=t.anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),i=t.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],u=A.from(V(e)),a=bn(t,u),c=t.catalogs,l=Gt.init(a,c),f={type:"panel",items:L([r,o,i,I([c.anchor.map(rt.createUi("anchor","Anchors")),c.rels.map(rt.createUi("rel","Rel")),c.targets.map(rt.createUi("target","Open link in...")),c.link.map(rt.createUi("link","Link list")),c.classes.map(rt.createUi("linkClass","Class"))])])};return{title:"Insert/Edit Link",size:"normal",body:f,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:a,onChange:function(t,n){var e=n.name;l.onChange(t.getData,{name:e}).each(function(n){t.setData(n)})},onSubmit:n}},wn=function(t){var n=xn(t);n.then(function(n){var e=yn(t,n);return On(n,e,t)}).then(function(n){t.windowReceptionist.open(n)})},Cn=function(t,n){document.body.appendChild(t),t.dispatchEvent(n),document.body.removeChild(t)},An=function(t){var n=document.createElement("a");n.target="_blank",n.href=t,n.rel="noreferrer noopener";var e=document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),Cn(n,e)},Nn=function(t,n){return t.dom.getParent(n,"a[href]")},Tn=function(t){return Nn(t,t.selection.getStart())},Pn=function(t){return!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey},Rn=function(t,n){if(n){var e=yt(n);if(/^#/.test(e)){var r=t.$(e);r.length&&t.selection.scrollIntoView(r[0],!0)}else An(n.href)}},Sn=function(t){return function(){wn(t)}},_n=function(t){return function(){Rn(t,Tn(t))}},Dn=function(t){t.on("click",function(n){var e=Nn(t,n.target);e&&i.metaKeyPressed(n)&&(n.preventDefault(),Rn(t,e))}),t.on("keydown",function(n){var e=Tn(t);e&&13===n.keyCode&&Pn(n)&&(n.preventDefault(),Rn(t,e))})},Ln=function(t,n){return t.on("NodeChange",n),function(){return t.off("NodeChange",n)}},En=function(t){return function(n){var e=function(){return n.setActive(!t.mode.isReadOnly()&&null!==Ot(t,t.selection.getNode()))};return e(),Ln(t,e)}},Un=function(t){return function(n){var e=function(){return n.setDisabled(null===Ot(t,t.selection.getNode()))};return e(),Ln(t,e)}},Bn=function(t){return function(n){var e=function(n){return Ct(n)||At(t.selection.getRng())},r=t.dom.getParents(t.selection.getStart());return n.setDisabled(!e(r)),Ln(t,function(t){return n.setDisabled(!e(t.parents))})}},In=function(t){t.addCommand("mceLink",function(){J(t)?t.fire("contexttoolbar-show",{toolbarKey:"quicklink"}):Sn(t)()})},Kn=function(t){t.addShortcut("Meta+K","",function(){t.execCommand("mceLink")})},Mn=function(t){t.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:Sn(t),onSetup:En(t)}),t.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:_n(t),onSetup:Un(t)}),t.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return Mt(t)},onSetup:Bn(t)})},zn=function(t){t.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:_n(t),onSetup:Un(t)}),t.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:Sn(t)}),t.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return Mt(t)},onSetup:Bn(t)})},jn=function(t){var n="link unlink openlink",e="link";t.ui.registry.addContextMenu("link",{update:function(r){return Ct(t.dom.getParents(r,"a"))?n:e}})},Vn=function(t){var n=function(t){t.selection.collapse(!1)},e=function(n){var e=t.selection.getNode();return n.setDisabled(!Ot(t,e)),h},r=function(n){var e=Ot(t),r=Nt(t);if(!e&&r){var o=wt(t.selection,e);return A.some(o.length>0?o:n)}return A.none()};t.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:En(t)},label:"Link",predicate:function(n){return!!Ot(t,n)&&z(t)},initValue:function(){var n=Ot(t);return n?yt(n):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(n){var e=t.selection.getNode();return n.setActive(!!Ot(t,e)),En(t)(n)},onAction:function(e){var o=e.getValue(),i=r(o),u={href:o,attach:h};Kt(t,u,{href:o,text:i,title:A.none(),rel:A.none(),target:A.none(),class:A.none()}),n(t),e.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:e,onAction:function(n){Mt(t),n.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:e,onAction:function(n){_n(t)(),n.hide()}}]})};t()})();