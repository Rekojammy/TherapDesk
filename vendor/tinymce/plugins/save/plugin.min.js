(function(){"use strict";function n(){e.add("save",function(n){m(n),s(n)})}var e=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),t=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),o=tinymce.util.Tools.resolve("tinymce.util.Tools"),i=function(n){return n.getParam("save_enablewhendirty",!0)},a=function(n){return!!n.getParam("save_onsavecallback")},c=function(n){return!!n.getParam("save_oncancelcallback")},r=function(n,e){n.notificationReceptionist.open({text:e,type:"error"})},u=function(n){var e=t.DOM.getParent(n.id,"form");if(!i(n)||n.isDirty()){if(n.save(),a(n))return n.execCallback("save_onsavecallback",n),void n.nodeChanged();e?(n.setDirty(!1),e.onsubmit&&!e.onsubmit()||("function"==typeof e.submit?e.submit():r(n,"Error: Form submit field collision.")),n.nodeChanged()):r(n,"Error: No form element found.")}},l=function(n){var e=o.trim(n.startContent);c(n)?n.execCallback("save_oncancelcallback",n):n.resetContent(e)},s=function(n){n.addCommand("mceSave",function(){u(n)}),n.addCommand("mceCancel",function(){l(n)})},d=function(n){return function(e){var t=function(){e.setDisabled(i(n)&&!n.isDirty())};return t(),n.on("NodeChange dirty",t),function(){return n.off("NodeChange dirty",t)}}},m=function(n){n.ui.registry.addButton("save",{icon:"save",tooltip:"Save",disabled:!0,onAction:function(){return n.execCommand("mceSave")},onSetup:d(n)}),n.ui.registry.addButton("cancel",{icon:"cancel",tooltip:"Cancel",disabled:!0,onAction:function(){return n.execCommand("mceCancel")},onSetup:d(n)}),n.addShortcut("Meta+S","","mceSave")};n()})();