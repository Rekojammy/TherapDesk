(function(){"use strict";function t(){i.add("image",function(t){yn(t),Dn(t),hn(t)})}var e,n,r,i=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),a=function(){return a=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n],e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},a.apply(this,arguments)},o=function(t){var e=typeof t;return null===t?"null":"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e},u=function(t){return function(e){return o(e)===t}},c=function(t){return function(e){return typeof e===t}},l=function(t){return function(e){return t===e}},s=u("string"),m=u("object"),f=u("array"),d=l(null),g=c("boolean"),p=function(t){return null==t},h=function(t){return!p(t)},b=c("function"),v=c("number"),y=function(){},D=function(t){return function(){return t}},A=function(t){return t},w=D(!1),S=D(!0),T=function(){return I},I=(e=function(t){return t()},n=A,r={fold:function(t,e){return t()},isSome:w,isNone:S,getOr:n,getOrThunk:e,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:D(null),getOrUndefined:D(void 0),or:n,orThunk:e,map:T,each:y,bind:T,exists:w,forall:S,filter:function(){return T()},toArray:function(){return[]},toString:D("none()")},r),U=function(t){var e=D(t),n=function(){return i},r=function(e){return e(t)},i={fold:function(e,n){return n(t)},isSome:S,isNone:w,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return U(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?i:I},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return i},x=function(t){return null==t?I:U(t)},C={some:U,none:T,from:x},N=Object.keys,O=Object.hasOwnProperty,E=function(t,e){for(var n=N(t),r=0,i=n.length;r<i;r++){var a=n[r],o=t[a];e(o,a)}},L=function(t){return function(e,n){t[n]=e}},k=function(t,e,n,r){var i={};return E(t,function(t,i){(e(t,i)?n:r)(t,i)}),i},P=function(t,e){var n={};return k(t,e,L(n),y),n},R=function(t,e){return O.call(t,e)},_=function(t,e){return R(t,e)&&void 0!==t[e]&&null!==t[e]},z=Array.prototype.push,j=function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!f(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);z.apply(e,t[n])}return e},M=function(t,e){return e>=0&&e<t.length?C.some(t[e]):C.none()},B=function(t){return M(t,0)},H=function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n],n);if(r.isSome())return r}return C.none()};"undefined"!=typeof window?window:Function("return this;")();var F=function(t,e,n){if(!(s(n)||g(n)||v(n)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",n,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,n+"")},G=function(t,e,n){F(t.dom,e,n)},W=function(t,e){t.dom.removeAttribute(e)},V=function(t,e){var n=e||document,r=n.createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||r.childNodes.length>1)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return K(r.childNodes[0])},$=function(t,e){var n=e||document,r=n.createElement(t);return K(r)},J=function(t,e){var n=e||document,r=n.createTextNode(t);return K(r)},K=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},X=function(t,e,n){return C.from(t.dom.elementFromPoint(e,n)).map(K)},Z={fromHtml:V,fromTag:$,fromText:J,fromDom:K,fromPoint:X},q=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Q=tinymce.util.Tools.resolve("tinymce.util.Promise"),Y=tinymce.util.Tools.resolve("tinymce.util.URI"),tt=tinymce.util.Tools.resolve("tinymce.util.XHR"),et=function(t){return t.getParam("image_dimensions",!0,"boolean")},nt=function(t){return t.getParam("image_advtab",!1,"boolean")},rt=function(t){return t.getParam("image_uploadtab",!0,"boolean")},it=function(t){return t.getParam("image_prepend_url","","string")},at=function(t){return t.getParam("image_class_list")},ot=function(t){return t.getParam("image_description",!0,"boolean")},ut=function(t){return t.getParam("image_title",!1,"boolean")},ct=function(t){return t.getParam("image_caption",!1,"boolean")},lt=function(t){return t.getParam("image_list",!1)},st=function(t){return h(t.getParam("images_upload_url"))},mt=function(t){return h(t.getParam("images_upload_handler"))},ft=function(t){return t.getParam("a11y_advanced_options",!1,"boolean")},dt=function(t){return t.getParam("automatic_uploads",!0,"boolean")},gt=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},pt=function(t){return new Q(function(e){var n=document.createElement("img"),r=function(t){n.onload=n.onerror=null,n.parentNode&&n.parentNode.removeChild(n),e(t)};n.onload=function(){var t=gt(n.width,n.clientWidth),e=gt(n.height,n.clientHeight),i={width:t,height:e};r(Q.resolve(i))},n.onerror=function(){r(Q.reject("Failed to get image dimensions for: "+t))};var i=n.style;i.visibility="hidden",i.position="fixed",i.bottom=i.left="0px",i.width=i.height="auto",document.body.appendChild(n),n.src=t})},ht=function(t){return t&&(t=t.replace(/px$/,"")),t},bt=function(t){return t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t},vt=function(t){if(t.margin){var e=String(t.margin).split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},yt=function(t,e){var n=lt(t);s(n)?tt.send({url:n,success:function(t){e(JSON.parse(t))}}):b(n)?n(e):e(n)},Dt=function(t,e,n){var r=function(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())};n.onload=function(){e.width||e.height||!et(t)||t.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),r()},n.onerror=r},At=function(t){return new Q(function(e,n){var r=new FileReader;r.onload=function(){e(r.result)},r.onerror=function(){n(r.error.message)},r.readAsDataURL(t)})},wt=function(t){return"IMG"===t.nodeName&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder"))},St=function(t,e){return Y.isDomSafe(e,"img",t.settings)},Tt=q.DOM,It=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?ht(t.style.marginLeft):""},Ut=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?ht(t.style.marginTop):""},xt=function(t){return t.style.borderWidth?ht(t.style.borderWidth):""},Ct=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},Nt=function(t,e){return t.style[e]?t.style[e]:""},Ot=function(t){return null!==t.parentNode&&"FIGURE"===t.parentNode.nodeName},Et=function(t,e,n){""===n?t.removeAttribute(e):t.setAttribute(e,n)},Lt=function(t){var e=Tt.create("figure",{class:"image"});Tt.insertAfter(e,t),e.appendChild(t),e.appendChild(Tt.create("figcaption",{contentEditable:"true"},"Caption")),e.contentEditable="false"},kt=function(t){var e=t.parentNode;Tt.insertAfter(t,e),Tt.remove(e)},Pt=function(t){Ot(t)?kt(t):Lt(t)},Rt=function(t,e){var n=t.getAttribute("style"),r=e(null!==n?n:"");r.length>0?(t.setAttribute("style",r),t.setAttribute("data-mce-style",r)):t.removeAttribute("style")},_t=function(t,e){return function(t,n,r){t.style[n]?(t.style[n]=bt(r),Rt(t,e)):Et(t,n,r)}},zt=function(t,e){return t.style[e]?ht(t.style[e]):Ct(t,e)},jt=function(t,e){var n=bt(e);t.style.marginLeft=n,t.style.marginRight=n},Mt=function(t,e){var n=bt(e);t.style.marginTop=n,t.style.marginBottom=n},Bt=function(t,e){var n=bt(e);t.style.borderWidth=n},Ht=function(t,e){t.style.borderStyle=e},Ft=function(t){return Nt(t,"borderStyle")},Gt=function(t){return"FIGURE"===t.nodeName},Wt=function(t){return"IMG"===t.nodeName},Vt=function(t){return 0===Tt.getAttrib(t,"alt").length&&"presentation"===Tt.getAttrib(t,"role")},$t=function(t){return Vt(t)?"":Ct(t,"alt")},Jt=function(){return{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}},Kt=function(t,e){var n=document.createElement("img");return Et(n,"style",e.style),(It(n)||""!==e.hspace)&&jt(n,e.hspace),(Ut(n)||""!==e.vspace)&&Mt(n,e.vspace),(xt(n)||""!==e.border)&&Bt(n,e.border),(Ft(n)||""!==e.borderStyle)&&Ht(n,e.borderStyle),t(n.getAttribute("style"))},Xt=function(t,e){var n=document.createElement("img");if(ee(t,a(a({},e),{caption:!1}),n),Qt(n,e.alt,e.isDecorative),e.caption){var r=Tt.create("figure",{class:"image"});return r.appendChild(n),r.appendChild(Tt.create("figcaption",{contentEditable:"true"},"Caption")),r.contentEditable="false",r}return n},Zt=function(t,e){return{src:Ct(e,"src"),alt:$t(e),title:Ct(e,"title"),width:zt(e,"width"),height:zt(e,"height"),class:Ct(e,"class"),style:t(Ct(e,"style")),caption:Ot(e),hspace:It(e),vspace:Ut(e),border:xt(e),borderStyle:Nt(e,"borderStyle"),isDecorative:Vt(e)}},qt=function(t,e,n,r,i){n[r]!==e[r]&&i(t,r,n[r])},Qt=function(t,e,n){if(n){Tt.setAttrib(t,"role","presentation");var r=Z.fromDom(t);G(r,"alt","")}else{if(d(e)){r=Z.fromDom(t);W(r,"alt")}else{r=Z.fromDom(t);G(r,"alt",e)}"presentation"===Tt.getAttrib(t,"role")&&Tt.setAttrib(t,"role","")}},Yt=function(t,e,n){n.alt===e.alt&&n.isDecorative===e.isDecorative||Qt(t,n.alt,n.isDecorative)},te=function(t,e){return function(n,r,i){t(n,i),Rt(n,e)}},ee=function(t,e,n){var r=Zt(t,n);qt(n,r,e,"caption",function(t,e,n){return Pt(t)}),qt(n,r,e,"src",Et),qt(n,r,e,"title",Et),qt(n,r,e,"width",_t("width",t)),qt(n,r,e,"height",_t("height",t)),qt(n,r,e,"class",Et),qt(n,r,e,"style",te(function(t,e){return Et(t,"style",e)},t)),qt(n,r,e,"hspace",te(jt,t)),qt(n,r,e,"vspace",te(Mt,t)),qt(n,r,e,"border",te(Bt,t)),qt(n,r,e,"borderStyle",te(Ht,t)),Yt(n,r,e)},ne=function(t,e){var n=t.dom.styles.parse(e),r=vt(n),i=t.dom.styles.parse(t.dom.styles.serialize(r));return t.dom.styles.serialize(i)},re=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||wt(e))?null:e},ie=function(t,e){var n=t.dom,r=P(t.schema.getTextBlockElements(),function(e,n){return!t.schema.isValidChild(n,"figure")}),i=n.getParent(e.parentNode,function(t){return _(r,t.nodeName)},t.getBody());return i?n.split(i,e):e},ae=function(t){var e=re(t);return e?Zt(function(e){return ne(t,e)},e):Jt()},oe=function(t,e){var n=Xt(function(e){return ne(t,e)},e);t.dom.setAttrib(n,"data-mce-id","__mcenew"),t.focus(),t.selection.setContent(n.outerHTML);var r=t.dom.select('*[data-mce-id="__mcenew"]')[0];if(t.dom.setAttrib(r,"data-mce-id",null),Gt(r)){var i=ie(t,r);t.selection.select(i)}else t.selection.select(r)},ue=function(t,e){t.dom.setAttrib(e,"src",e.getAttribute("src"))},ce=function(t,e){if(e){var n=t.dom.is(e.parentNode,"figure.image")?e.parentNode:e;t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}},le=function(t,e){var n=re(t);if(ee(function(e){return ne(t,e)},e,n),ue(t,n),Gt(n.parentNode)){var r=n.parentNode;ie(t,r),t.selection.select(n.parentNode)}else t.selection.select(n),Dt(t,e,n)},se=function(t,e){var n=e.src;return a(a({},e),{src:St(t,n)?n:""})},me=function(t,e){var n=re(t);if(n){var r=Zt(function(e){return ne(t,e)},n),i=a(a({},r),e),o=se(t,i);i.src?le(t,o):ce(t,n)}else e.src&&oe(t,a(a({},Jt()),e))},fe=function(t,e){var n=m(t)&&m(e);return n?ge(t,e):e},de=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},i=0;i<e.length;i++){var a=e[i];for(var o in a)R(a,o)&&(r[o]=t(r[o],a[o]))}return r}},ge=de(fe),pe=function(t){return t.length>0},he=tinymce.util.Tools.resolve("tinymce.util.ImageUploader"),be=tinymce.util.Tools.resolve("tinymce.util.Tools"),ve=function(t){return s(t.value)?t.value:""},ye=function(t){return s(t.text)?t.text:s(t.title)?t.title:""},De=function(t,e){var n=[];return be.each(t,function(t){var r=ye(t);if(void 0!==t.menu){var i=De(t.menu,e);n.push({text:r,items:i})}else{var a=e(t);n.push({text:r,value:a})}}),n},Ae=function(t){return void 0===t&&(t=ve),function(e){return e?C.from(e).map(function(e){return De(e,t)}):C.none()}},we=function(t){return Ae(ve)(t)},Se=function(t){return R(t,"items")},Te=function(t,e){return H(t,function(t){return Se(t)?Te(t.items,e):t.value===e?C.some(t):C.none()})},Ie=function(t,e){return t.bind(function(t){return Te(t,e)})},Ue={sanitizer:Ae,sanitize:we,findEntry:Ie},xe=function(t){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"listbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},Ce={makeTab:xe},Ne=function(t){var e=Ue.sanitizer(function(e){return t.convertURL(e.value||e.url,"src")}),n=new Q(function(n){yt(t,function(t){n(e(t).map(function(t){return j([[{text:"None",value:""}],t])}))})}),r=Ue.sanitize(at(t)),i=nt(t),a=rt(t),o=st(t),u=mt(t),c=ae(t),l=ot(t),m=ut(t),f=et(t),d=ct(t),g=ft(t),p=dt(t),h=C.some(it(t)).filter(function(t){return s(t)&&t.length>0});return n.then(function(t){return{image:c,imageList:t,classList:r,hasAdvTab:i,hasUploadTab:a,hasUploadUrl:o,hasUploadHandler:u,hasDescription:l,hasImageTitle:m,hasDimensions:f,hasImageCaption:d,prependURL:h,hasAccessibilityOptions:g,automaticUploads:p}})},Oe=function(t){var e={name:"src",type:"urlinput",filetype:"image",label:"Source"},n=t.imageList.map(function(t){return{name:"images",type:"listbox",label:"Image list",items:t}}),r={name:"alt",type:"input",label:"Alternative description",disabled:t.hasAccessibilityOptions&&t.image.isDecorative},i={name:"title",type:"input",label:"Image title"},o={name:"dimensions",type:"sizeinput"},u={type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]},c=t.classList.map(function(t){return{name:"classes",type:"listbox",label:"Class",items:t}}),l={type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]},s=function(t){return t?{type:"grid",columns:2}:{type:"panel"}};return j([[e],n.toArray(),t.hasAccessibilityOptions&&t.hasDescription?[u]:[],t.hasDescription?[r]:[],t.hasImageTitle?[i]:[],t.hasDimensions?[o]:[],[a(a({},s(t.classList.isSome()&&t.hasImageCaption)),{items:j([c.toArray(),t.hasImageCaption?[l]:[]])})]])},Ee=function(t){return{title:"General",name:"general",items:Oe(t)}},Le={makeTab:Ee,makeItems:Oe},ke=function(t){var e=[{type:"dropzone",name:"fileinput"}];return{title:"Upload",name:"upload",items:e}},Pe={makeTab:ke},Re=function(t){return{prevImage:Ue.findEntry(t.imageList,t.image.src),prevAlt:t.image.alt,open:!0}},_e=function(t){return{src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:t.caption,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[],isDecorative:t.isDecorative}},ze=function(t,e){return{src:t.src.value,alt:0===t.alt.length&&e?null:t.alt,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle,isDecorative:t.isDecorative}},je=function(t,e){return/^(?:[a-zA-Z]+:)?\/\//.test(e)?C.none():t.prependURL.bind(function(t){return e.substring(0,t.length)!==t?C.some(t+e):C.none()})},Me=function(t,e){var n=e.getData();je(t,n.src.value).each(function(t){e.setData({src:{value:t,meta:n.src.meta}})})},Be=function(t,e,n){t.hasDescription&&s(n.alt)&&(e.alt=n.alt),t.hasAccessibilityOptions&&(e.isDecorative=n.isDecorative||e.isDecorative||!1),t.hasImageTitle&&s(n.title)&&(e.title=n.title),t.hasDimensions&&(s(n.width)&&(e.dimensions.width=n.width),s(n.height)&&(e.dimensions.height=n.height)),s(n.class)&&Ue.findEntry(t.classList,n.class).each(function(t){e.classes=t.value}),t.hasImageCaption&&g(n.caption)&&(e.caption=n.caption),t.hasAdvTab&&(s(n.style)&&(e.style=n.style),s(n.vspace)&&(e.vspace=n.vspace),s(n.border)&&(e.border=n.border),s(n.hspace)&&(e.hspace=n.hspace),s(n.borderstyle)&&(e.borderstyle=n.borderstyle))},He=function(t,e){var n=e.getData(),r=n.src.meta;if(void 0!==r){var i=ge({},n);Be(t,i,r),e.setData(i)}},Fe=function(t,e,n,r){var i=r.getData(),a=i.src.value,o=i.src.meta||{};o.width||o.height||!e.hasDimensions||(pe(a)?t.imageSize(a).then(function(t){n.open&&r.setData({dimensions:t})}).catch(function(t){return console.error(t)}):r.setData({dimensions:{width:"",height:""}}))},Ge=function(t,e,n){var r=n.getData(),i=Ue.findEntry(t.imageList,r.src.value);e.prevImage=i,n.setData({images:i.map(function(t){return t.value}).getOr("")})},We=function(t,e,n,r){Me(e,r),He(e,r),Fe(t,e,n,r),Ge(e,n,r)},Ve=function(t,e,n,r){var i=r.getData(),a=Ue.findEntry(e.imageList,i.images);a.each(function(t){var e=""===i.alt||n.prevImage.map(function(t){return t.text===i.alt}).getOr(!1);e?""===t.value?r.setData({src:t,alt:n.prevAlt}):r.setData({src:t,alt:t.text}):r.setData({src:t})}),n.prevImage=a,We(t,e,n,r)},$e=function(t){var e=t["margin-top"]&&t["margin-bottom"]&&t["margin-top"]===t["margin-bottom"];return e?ht(String(t["margin-top"])):""},Je=function(t){var e=t["margin-right"]&&t["margin-left"]&&t["margin-right"]===t["margin-left"];return e?ht(String(t["margin-right"])):""},Ke=function(t){return t["border-width"]?ht(String(t["border-width"])):""},Xe=function(t){return t["border-style"]?String(t["border-style"]):""},Ze=function(t,e,n){return e(t(e(n)))},qe=function(t,e,n){var r=vt(t(n.style)),i=ge({},n);return i.vspace=$e(r),i.hspace=Je(r),i.border=Ke(r),i.borderstyle=Xe(r),i.style=Ze(t,e,r),i},Qe=function(t,e){var n=e.getData(),r=qe(t.parseStyle,t.serializeStyle,n);e.setData(r)},Ye=function(t,e,n){var r=ge(_e(e.image),n.getData()),i=Kt(t.normalizeCss,ze(r,!1));n.setData({style:i})},tn=function(t,e,n,r){var i=r.getData();r.block("Uploading image"),B(i.fileinput).fold(function(){r.unblock()},function(i){var a=URL.createObjectURL(i),o=function(){r.unblock(),URL.revokeObjectURL(a)},u=function(i){r.setData({src:{value:i,meta:{}}}),r.showTab("general"),We(t,e,n,r)};At(i).then(function(n){var c=t.createBlobCache(i,a,n);e.automaticUploads?t.uploadImage(c).then(function(t){u(t.url),o()}).catch(function(e){o(),t.alertErr(e)}):(t.addToBlobCache(c),u(c.blobUri()),r.unblock())})})},en=function(t,e,n){return function(r,i){"src"===i.name?We(t,e,n,r):"images"===i.name?Ve(t,e,n,r):"alt"===i.name?n.prevAlt=r.getData().alt:"style"===i.name?Qe(t,r):"vspace"===i.name||"hspace"===i.name||"border"===i.name||"borderstyle"===i.name?Ye(t,e,r):"fileinput"===i.name?tn(t,e,n,r):"isDecorative"===i.name&&(r.getData().isDecorative?r.disable("alt"):r.enable("alt"))}},nn=function(t){return function(){t.open=!1}},rn=function(t){if(t.hasAdvTab||t.hasUploadUrl||t.hasUploadHandler){var e={type:"tabpanel",tabs:j([[Le.makeTab(t)],t.hasAdvTab?[Ce.makeTab(t)]:[],t.hasUploadTab&&(t.hasUploadUrl||t.hasUploadHandler)?[Pe.makeTab(t)]:[]])};return e}var n={type:"panel",items:Le.makeItems(t)};return n},an=function(t){return function(e){var n=Re(e);return{title:"Insert/Edit Image",size:"normal",body:rn(e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:_e(e.image),onSubmit:t.onSubmit(e),onChange:en(t,e,n),onClose:nn(n)}}},on=function(t){return function(e){return function(n){var r=ge(_e(e.image),n.getData());t.execCommand("mceUpdateImage",!1,ze(r,e.hasAccessibilityOptions)),t.editorUpload.uploadImagesAuto(),n.close()}}},un=function(t){return function(e){return St(t,e)?pt(t.documentBaseURI.toAbsolute(e)).then(function(t){return{width:String(t.width),height:String(t.height)}}):Q.resolve({width:"",height:""})}},cn=function(t){return function(e,n,r){return t.editorUpload.blobCache.create({blob:e,blobUri:n,name:e.name?e.name.replace(/\.[^\.]+$/,""):null,filename:e.name,base64:r.split(",")[1]})}},ln=function(t){return function(e){t.editorUpload.blobCache.add(e)}},sn=function(t){return function(e){t.windowReceptionist.alert(e)}},mn=function(t){return function(e){return ne(t,e)}},fn=function(t){return function(e){return t.dom.parseStyle(e)}},dn=function(t){return function(e,n){return t.dom.serializeStyle(e,n)}},gn=function(t){return function(e){return he(t).upload([e],!1).then(function(t){return 0===t.length?Q.reject("Failed to upload image"):!1===t[0].status?Q.reject(t[0].error.message):t[0]})}},pn=function(t){var e={onSubmit:on(t),imageSize:un(t),addToBlobCache:ln(t),createBlobCache:cn(t),alertErr:sn(t),normalizeCss:mn(t),parseStyle:fn(t),serializeStyle:dn(t),uploadImage:gn(t)},n=function(){Ne(t).then(an(e)).then(t.windowReceptionist.open)};return{open:n}},hn=function(t){t.addCommand("mceImage",pn(t).open),t.addCommand("mceUpdateImage",function(e,n){t.undoReceptionist.transact(function(){return me(t,n)})})},bn=function(t){var e=t.attr("class");return e&&/\bimage\b/.test(e)},vn=function(t){return function(e){for(var n=e.length,r=function(e){e.attr("contenteditable",t?"true":null)};n--;){var i=e[n];bn(i)&&(i.attr("contenteditable",t?"false":null),be.each(i.getAll("figcaption"),r))}}},yn=function(t){t.on("PreInit",function(){t.parser.addNodeFilter("figure",vn(!0)),t.serializer.addNodeFilter("figure",vn(!1))})},Dn=function(t){t.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:pn(t).open,onSetup:function(e){return e.setActive(h(re(t))),t.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",e.setActive).unbind}}),t.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:pn(t).open}),t.ui.registry.addContextMenu("image",{update:function(t){return Gt(t)||Wt(t)&&!wt(t)?["image"]:[]}})};t()})();