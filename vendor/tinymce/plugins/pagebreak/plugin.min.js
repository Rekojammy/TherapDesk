(function(){"use strict";function e(){n.add("pagebreak",function(e){u(e),s(e),c(e),g(e)})}var n=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),t=tinymce.util.Tools.resolve("tinymce.Env"),a=function(e){return e.getParam("pagebreak_separator","<!-- pagebreak -->")},r=function(e){return e.getParam("pagebreak_split_block",!1)},o="mce-pagebreak",i=function(e){var n='<img src="'+t.transparentSrc+'" class="'+o+'" data-mce-resize="false" data-mce-placeholder />';return e?"<p>"+n+"</p>":n},c=function(e){var n=a(e),t=function(){return r(e)},c=new RegExp(n.replace(/[\?\.\*\[\]\(\)\{\}\+\^\$\:]/g,function(e){return"\\"+e}),"gi");e.on("BeforeSetContent",function(e){e.content=e.content.replace(c,i(t()))}),e.on("PreInit",function(){e.serializer.addNodeFilter("img",function(a){for(var r,i,c=a.length;c--;)if(r=a[c],i=r.attr("class"),i&&-1!==i.indexOf(o)){var u=r.parent;if(e.schema.getBlockElements()[u.name]&&t()){u.type=3,u.value=n,u.raw=!0,r.remove();continue}r.type=3,r.value=n,r.raw=!0}})})},u=function(e){e.addCommand("mcePageBreak",function(){e.insertContent(i(r(e)))})},g=function(e){e.on("ResolveName",function(n){"IMG"===n.target.nodeName&&e.dom.hasClass(n.target,o)&&(n.name="pagebreak")})},s=function(e){var n=function(){return e.execCommand("mcePageBreak")};e.ui.registry.addButton("pagebreak",{icon:"page-break",tooltip:"Page break",onAction:n}),e.ui.registry.addMenuItem("pagebreak",{text:"Page break",icon:"page-break",onAction:n})};e()})();