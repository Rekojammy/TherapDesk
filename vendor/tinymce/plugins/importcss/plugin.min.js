(function(){"use strict";function t(){n.add("importcss",function(t){return L(t),z(t)})}var n=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),e=function(t){var n=typeof t;return null===t?"null":"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n},r=function(t){return function(n){return e(n)===t}},i=r("string"),o=r("array"),c=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),u=tinymce.util.Tools.resolve("tinymce.EditorReceptionist"),s=tinymce.util.Tools.resolve("tinymce.Env"),a=tinymce.util.Tools.resolve("tinymce.util.Tools"),l=function(t){return t.getParam("importcss_merge_classes")},f=function(t){return t.getParam("importcss_exclusive")},m=function(t){return t.getParam("importcss_selector_converter")},p=function(t){return t.getParam("importcss_selector_filter")},v=function(t){return t.getParam("importcss_groups")},y=function(t){return t.getParam("importcss_append")},g=function(t){return t.getParam("importcss_file_filter")},h=function(t){var n=t.getParam("skin");return!1!==n&&(n||"oxide")},d=function(t){return t.getParam("skin_url")},_=Array.prototype.push,x=function(t,n){for(var e=t.length,r=new Array(e),i=0;i<e;i++){var o=t[i];r[i]=n(o,i)}return r},P=function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!o(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);_.apply(n,t[e])}return n},T=function(t,n){return P(x(t,n))},b=function(){var t=[],n=[],e={},r=function(t,r){e[t]?e[t].push(r):(n.push(t),e[t]=[r])},i=function(n){t.push(n)},o=function(){var r=T(n,function(t){var n=e[t];return 0===n.length?[]:[{title:t,items:n}]});return r.concat(t)};return{addItemToGroup:r,addItem:i,toFormats:o}},S=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,k=function(t){var n=s.cacheSuffix;return i(t)&&(t=t.replace("?"+n,"").replace("&"+n,"")),t},R=function(t,n){var e=h(t);if(e){var r=d(t),i=r?t.documentBaseURI.toAbsolute(r):u.baseURL+"/skins/ui/"+e,o=u.baseURL+"/skins/content/";return n===i+"/content"+(t.inline?".inline":"")+".min.css"||-1!==n.indexOf(o)}return!1},w=function(t){return i(t)?function(n){return-1!==n.indexOf(t)}:t instanceof RegExp?function(n){return t.test(n)}:t},A=function(t){return t.styleSheet},E=function(t){return t.selectorText},I=function(t,n,e){var r=[],i={},o=function(n,i){var c,u=n.href;if(u=k(u),u&&e(u,i)&&!R(t,u)){a.each(n.imports,function(t){o(t,!0)});try{c=n.cssRules||n.rules}catch(t){}a.each(c,function(t){A(t)?o(t.styleSheet,!0):E(t)&&a.each(t.selectorText.split(","),function(t){r.push(a.trim(t))})})}};a.each(t.contentCSS,function(t){i[t]=!0}),e||(e=function(t,n){return n||i[t]});try{a.each(n.styleSheets,function(t){o(t)})}catch(t){}return r},O=function(t,n){var e,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(n);if(r){var i=r[1],o=r[2].substr(1).split(".").join(" "),c=a.makeMap("a,img");return r[1]?(e={title:n},t.schema.getTextBlockElements()[i]?e.block=i:t.schema.getBlockElements()[i]||c[i.toLowerCase()]?e.selector=i:e.inline=i):r[2]&&(e={inline:"span",title:n.substr(1),classes:o}),!1!==l(t)?e.classes=o:e.attributes={class:o},e}},M=function(t,n){return a.grep(t,function(t){return!t.filter||t.filter(n)})},U=function(t){return a.map(t,function(t){return a.extend({},t,{original:t,selectors:{},filter:w(t.filter)})})},j=function(t,n){return null===n||!1!==f(t)},B=function(t,n,e,r){return!(j(t,e)?n in r:n in e.selectors)},D=function(t,n,e,r){j(t,e)?r[n]=!0:e.selectors[n]=!0},F=function(t,n,e,r){var i;return i=r&&r.selector_converter?r.selector_converter:m(t)?m(t):function(){return O(t,e)},i.call(n,e,r)},L=function(t){t.on("init",function(){var n=b(),e={},r=w(p(t)),i=U(v(t)),o=function(n,r){if(B(t,n,r,e)){D(t,n,r,e);var i=F(t,t.plugins.importcss,n,r);if(i){var o=i.name||c.DOM.uniqueId();return t.formatter.register(o,i),{title:i.title,format:o}}}return null};a.each(I(t,t.getDoc(),w(g(t))),function(t){if(!S.test(t)&&(!r||r(t))){var e=M(i,t);if(e.length>0)a.each(e,function(e){var r=o(t,e);r&&n.addItemToGroup(e.title,r)});else{var c=o(t,null);c&&n.addItem(c)}}});var u=n.toFormats();t.fire("addStyleModifications",{items:u,replace:!y(t)})})},z=function(t){var n=function(n){return O(t,n)};return{convertSelectorToFormat:n}};t()})();