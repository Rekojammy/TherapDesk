(function(){"use strict";function t(t,n,e,r,o){return t(e,r)?H.some(e):O(o)&&o(e)?H.none():n(e,r,o)}function n(){i.add("quickbars",function(t){b(t),it(t),ut(t)})}var e,r,o,i=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),u=0,c=function(t){var n=new Date,e=n.getTime(),r=Math.floor(1e9*Math.random());return u++,t+"_"+r+u+String(e)},a=function(t,n){var e='<table data-mce-id="mce" style="width: 100%">';e+="<tbody>";for(var r=0;r<n;r++){e+="<tr>";for(var o=0;o<t;o++)e+="<td><br></td>";e+="</tr>"}return e+="</tbody>",e+="</table>",e},l=function(t){var n=t.dom.select("*[data-mce-id]");return n[0]},f=function(t,n,e){t.undoReceptionist.transact(function(){t.insertContent(a(n,e));var r=l(t);r.removeAttribute("data-mce-id");var o=t.dom.select("td,th",r);t.selection.setCursorLocation(o[0],0)})},s=function(t,n,e){t.plugins.table?t.plugins.table.insertTable(n,e):f(t,n,e)},d=function(t,n,e){var r=t.editorUpload.blobCache,o=r.create(c("mceu"),e,n);r.add(o),t.insertContent(t.dom.createHTML("img",{src:o.blobUri()}))},m=tinymce.util.Tools.resolve("tinymce.util.Promise"),g=function(t){return new m(function(n){var e=new FileReader;e.onloadend=function(){n(e.result.split(",")[1])},e.readAsDataURL(t)})},v=tinymce.util.Tools.resolve("tinymce.Env"),h=tinymce.util.Tools.resolve("tinymce.util.Delay"),p=function(t){return new m(function(n){var e=document.createElement("input");e.type="file",e.accept="image/*",e.style.position="fixed",e.style.left="0",e.style.top="0",e.style.opacity="0.001",document.body.appendChild(e);var r=function(t){n(Array.prototype.slice.call(t.target.files))};e.addEventListener("change",r);var o=function(r){var i=function(){n([]),e.parentNode.removeChild(e)};v.os.isAndroid()&&"remove"!==r.type?h.setEditorTimeout(t,i,0):i(),t.off("focusin remove",o)};t.on("focusin remove",o),e.click()})},b=function(t){t.ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:function(){p(t).then(function(n){if(n.length>0){var e=n[0];g(e).then(function(n){d(t,n,e)})}})}}),t.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:function(){s(t,2,2)}})},y=function(t){var n=typeof t;return null===t?"null":"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n},w=function(t){return function(n){return y(n)===t}},k=function(t){return function(n){return typeof n===t}},T=function(t){return function(n){return t===n}},E=w("string"),N=w("object"),S=w("array"),C=k("boolean"),M=T(void 0),O=k("function"),q=function(){},x=function(t){return function(){return t}},A=function(t){return t},D=x(!1),L=x(!0),P=function(){return _},_=(e=function(t){return t()},r=A,o={fold:function(t,n){return t()},isSome:D,isNone:L,getOr:r,getOrThunk:e,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:x(null),getOrUndefined:x(void 0),or:r,orThunk:e,map:P,each:q,bind:P,exists:D,forall:L,filter:function(){return P()},toArray:function(){return[]},toString:x("none()")},o),U=function(t){var n=x(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},isSome:L,isNone:D,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return U(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:_},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},B=function(t){return null==t?_:U(t)},H={some:U,none:P,from:B},R=1,F=function(t,n){var e=n||document,r=e.createElement("div");if(r.innerHTML=t,!r.hasChildNodes()||r.childNodes.length>1)throw console.error("HTML does not have a single root node",t),new Error("HTML must have a single root node");return z(r.childNodes[0])},I=function(t,n){var e=n||document,r=e.createElement(t);return z(r)},j=function(t,n){var e=n||document,r=e.createTextNode(t);return z(r)},z=function(t){if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},G=function(t,n,e){return H.from(t.dom.elementFromPoint(n,e)).map(z)},J={fromHtml:F,fromTag:I,fromText:j,fromDom:z,fromPoint:G},K=function(t,n){var e=t.dom;if(e.nodeType!==R)return!1;var r=e;if(void 0!==r.matches)return r.matches(n);if(void 0!==r.msMatchesSelector)return r.msMatchesSelector(n);if(void 0!==r.webkitMatchesSelector)return r.webkitMatchesSelector(n);if(void 0!==r.mozMatchesSelector)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")};"undefined"!=typeof window?window:Function("return this;")();var Q=function(t){var n=t.dom.nodeName;return n.toLowerCase()},V=function(t,n,e){for(var r=t.dom,o=O(e)?e:D;r.parentNode;){r=r.parentNode;var i=J.fromDom(r);if(n(i))return H.some(i);if(o(i))break}return H.none()},W=function(n,e,r){var o=function(t,n){return n(t)};return t(o,V,n,e,r)},X=function(t,n,e){return V(t,function(t){return K(t,n)},e)},Y=function(n,e,r){var o=function(t,n){return K(t,n)};return t(o,X,n,e,r)},Z=function(t,n){if(n(t))return!0;throw new Error("Default value doesn't match requested type.")},$=function(t,n){if(S(t)||N(t))throw new Error("expected a string but found: "+t);return M(t)?n:C(t)?!1===t?"":n:t},tt=function(t){return function(n,e,r){Z(r,t);var o=n.getParam(e,r);return $(o,r)}},nt=tt(E),et=function(t){return nt(t,"quickbars_selection_toolbar","bold italic | quicklink h2 h3 blockquote")},rt=function(t){return nt(t,"quickbars_insert_toolbar","quickimage quicktable")},ot=function(t){return nt(t,"quickbars_image_toolbar","alignleft aligncenter alignright")},it=function(t){var n=rt(t);n.trim().length>0&&t.ui.registry.addContextToolbar("quickblock",{predicate:function(n){var e=J.fromDom(n),r=t.schema.getTextBlockElements(),o=function(n){return n.dom===t.getBody()};return Y(e,"table",o).fold(function(){return W(e,function(n){return Q(n)in r&&t.dom.isEmpty(n.dom)},o).isSome()},D)},items:n,position:"line",scope:"editor"})},ut=function(t){var n=function(n){return"false"!==t.dom.getContentEditableParent(n)},e=function(t){return"IMG"===t.nodeName||"FIGURE"===t.nodeName&&/image/i.test(t.className)},r=ot(t);r.trim().length>0&&t.ui.registry.addContextToolbar("imageselection",{predicate:e,items:r,position:"node"});var o=et(t);o.trim().length>0&&t.ui.registry.addContextToolbar("textselection",{predicate:function(r){return!e(r)&&!t.selection.isCollapsed()&&n(r)},items:o,position:"selection",scope:"editor"})};n()})();