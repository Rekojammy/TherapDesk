(function(){"use strict";function t(t,n,r){if(r||2===arguments.length)for(var e,o=0,a=n.length;o<a;o++)!e&&o in n||(e||(e=Array.prototype.slice.call(n,0,o)),e[o]=n[o]);return t.concat(e||Array.prototype.slice.call(n))}function n(){i.add("textpattern",function(t){var n=a(it(t));return ln(t,n),rt(n)})}var r,e,o,a=function(t){var n=t,r=function(){return n},e=function(t){n=t};return{get:r,set:e}},i=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),u=function(){return u=Object.assign||function(t){for(var n,r=1,e=arguments.length;r<e;r++)for(var o in n=arguments[r],n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t},u.apply(this,arguments)},f=function(t){var n=typeof t;return null===t?"null":"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n},c=function(t){return function(n){return f(n)===t}},s=c("string"),l=c("object"),d=c("array"),m=function(){},g=function(t){return function(){return t}},p=function(t){return t},v=function(t){return function(){throw new Error(t)}},h=g(!1),y=g(!0),b=function(){return k},k=(r=function(t){return t()},e=p,o={fold:function(t,n){return t()},isSome:h,isNone:y,getOr:e,getOrThunk:r,getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:g(null),getOrUndefined:g(void 0),or:e,orThunk:r,map:b,each:m,bind:b,exists:h,forall:y,filter:function(){return b()},toArray:function(){return[]},toString:g("none()")},o),O=function(t){var n=g(t),r=function(){return o},e=function(n){return n(t)},o={fold:function(n,r){return r(t)},isSome:y,isNone:h,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:r,orThunk:r,map:function(n){return O(n(t))},each:function(n){n(t)},bind:e,exists:e,forall:e,filter:function(n){return n(t)?o:k},toArray:function(){return[t]},toString:function(){return"some("+t+")"}};return o},w=function(t){return null==t?k:O(t)},C={some:O,none:b,from:w},R=Array.prototype.slice,E=Array.prototype.indexOf,x=function(t,n){return E.call(t,n)},T=function(t,n){return x(t,n)>-1},P=function(t,n){for(var r=t.length,e=new Array(r),o=0;o<r;o++){var a=t[o];e[o]=n(a,o)}return e},N=function(t,n){for(var r=0,e=t.length;r<e;r++){var o=t[r];n(o,r)}},S=function(t,n){for(var r=t.length-1;r>=0;r--){var e=t[r];n(e,r)}},A=function(t,n){for(var r=[],e=0,o=t.length;e<o;e++){var a=t[e];n(a,e)&&r.push(a)}return r},B=function(t,n,r){return S(t,function(t,e){r=n(r,t,e)}),r},D=function(t,n,r){return N(t,function(t,e){r=n(r,t,e)}),r},I=function(t,n,r){for(var e=0,o=t.length;e<o;e++){var a=t[e];if(n(a,e))return C.some(a);if(r(a,e))break}return C.none()},M=function(t,n){return I(t,n,h)},j=function(t,n){for(var r=0,e=t.length;r<e;++r){var o=t[r];if(!0!==n(o,r))return!1}return!0},_=function(t,n){var r=R.call(t,0);return r.sort(n),r},U=function(t,n){return n>=0&&n<t.length?C.some(t[n]):C.none()},L=function(t){return U(t,0)},V=Object.keys,W=Object.hasOwnProperty,q=function(t,n){return W.call(t,n)},F=function(t){if(!d(t))throw new Error("cases must be an array");if(0===t.length)throw new Error("there must be at least one case");var n=[],r={};return N(t,function(e,o){var a=V(e);if(1!==a.length)throw new Error("one and only one name per case");var i=a[0],u=e[i];if(void 0!==r[i])throw new Error("duplicate key detected:"+i);if("cata"===i)throw new Error("cannot have a case named cata (sorry)");if(!d(u))throw new Error("case arguments must be an array");n.push(i),r[i]=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];var a=r.length;if(a!==u.length)throw new Error("Wrong number of arguments to case "+i+". Expected "+u.length+" ("+u+"), got "+a);var f=function(t){var e=V(t);if(n.length!==e.length)throw new Error("Wrong number of arguments to match. Expected: "+n.join(",")+"\nActual: "+e.join(","));var o=j(n,function(t){return T(e,t)});if(!o)throw new Error("Not all branches were specified when using match. Specified: "+e.join(", ")+"\nRequired: "+n.join(", "));return t[i].apply(null,r)};return{fold:function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];if(n.length!==t.length)throw new Error("Wrong number of arguments to fold. Expected "+t.length+", got "+n.length);var a=n[o];return a.apply(null,r)},match:f,log:function(t){console.log(t,{constructors:n,constructor:i,params:r})}}}}),r},G={generate:F};G.generate([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]);var H=function(t){var n=[],r=[];return N(t,function(t){t.fold(function(t){n.push(t)},function(t){r.push(t)})}),{errors:n,values:r}},J=function(t){var n=function(n){return J(t)},r=function(n){return J(t)},e=function(n){return J(n(t))},o=function(n){return J(t)},a=function(n){n(t)},i=function(n){return n(t)},u=function(n,r){return r(t)},f=function(n){return n(t)},c=function(n){return n(t)},s=function(){return C.some(t)};return{isValue:y,isError:h,getOr:g(t),getOrThunk:g(t),getOrDie:g(t),or:n,orThunk:r,fold:u,map:e,mapError:o,each:a,bind:i,exists:f,forall:c,toOptional:s}},K=function(t){var n=function(t){return t()},r=function(){return v(String(t))()},e=p,o=function(t){return t()},a=function(n){return K(t)},i=function(n){return K(n(t))},u=function(n){return K(t)},f=function(n,r){return n(t)};return{isValue:h,isError:y,getOr:p,getOrThunk:n,getOrDie:r,or:e,orThunk:o,fold:f,map:a,mapError:i,each:m,bind:u,exists:h,forall:y,toOptional:C.none}},X=function(t,n){return t.fold(function(){return K(n)},J)},z={value:J,error:K,fromOption:X},Q=function(t){return"inline-command"===t.type||"inline-format"===t.type},Y=function(t){return"block-command"===t.type||"block-format"===t.type},Z=function(t){return _(t,function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1})},$=function(t){var n=function(n){return z.error({message:n,pattern:t})},r=function(r,e,o){if(void 0!==t.format){var a=void 0;if(d(t.format)){if(!j(t.format,s))return n(r+" pattern has non-string items in the `format` array");a=t.format}else{if(!s(t.format))return n(r+" pattern has non-string `format` parameter");a=[t.format]}return z.value(e(a))}return void 0!==t.cmd?s(t.cmd)?z.value(o(t.cmd,t.value)):n(r+" pattern has non-string `cmd` parameter"):n(r+" pattern is missing both `format` and `cmd` parameters")};if(!l(t))return n("Raw pattern is not an object");if(!s(t.start))return n("Raw pattern is missing `start` parameter");if(void 0!==t.end){if(!s(t.end))return n("Inline pattern has non-string `end` parameter");if(0===t.start.length&&0===t.end.length)return n("Inline pattern has empty `start` and `end` parameters");var e=t.start,o=t.end;return 0===o.length&&(o=e,e=""),r("Inline",function(t){return{type:"inline-format",start:e,end:o,format:t}},function(t,n){return{type:"inline-command",start:e,end:o,cmd:t,value:n}})}return void 0!==t.replacement?s(t.replacement)?0===t.start.length?n("Replacement pattern has empty `start` parameter"):z.value({type:"inline-command",start:"",end:t.start,cmd:"mceInsertContent",value:t.replacement}):n("Replacement pattern has non-string `replacement` parameter"):0===t.start.length?n("Block pattern has empty `start` parameter"):r("Block",function(n){return{type:"block-format",start:t.start,format:n[0]}},function(n,r){return{type:"block-command",start:t.start,cmd:n,value:r}})},tt=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},nt=function(t){return{inlinePatterns:A(t,Q),blockPatterns:Z(A(t,Y))}},rt=function(n){var r=function(t){var r=H(P(t,$));if(r.errors.length>0){var e=r.errors[0];throw new Error(e.message+":\n"+JSON.stringify(e.pattern,null,2))}n.set(nt(r.values))},e=function(){return t(t([],P(n.get().inlinePatterns,tt),!0),P(n.get().blockPatterns,tt),!0)};return{setPatterns:r,getPatterns:e}},et="undefined"!=typeof window?window:Function("return this;")(),ot=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=et.console;r&&(r.error?r.error.apply(r,t):r.log.apply(r,t))},at=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],it=function(t){var n=t.getParam("textpattern_patterns",at,"array");if(!d(n))return ot("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var r=H(P(n,$));return N(r.errors,function(t){return ot(t.message,t.pattern)}),nt(r.values)},ut=function(t){var n=t.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n},ft=tinymce.util.Tools.resolve("tinymce.util.Delay"),ct=tinymce.util.Tools.resolve("tinymce.util.VK"),st="\ufeff",lt="Â ",dt=tinymce.util.Tools.resolve("tinymce.util.Tools"),mt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),gt=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker"),pt=function(t,n){return{container:t,offset:n}},vt=function(t){return t.nodeType===Node.TEXT_NODE},ht=function(t,n,r){if(n&&t.isEmpty(n)&&!r(n)){var e=n.parentNode;t.remove(n),ht(t,e,r)}},yt=function(t,n,r,e){void 0===e&&(e=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),e&&!r(n.startContainer)&&(vt(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),vt(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),ht(t,o,r),o!==a&&ht(t,a,r))},bt=function(t,n){var r=n.get(t);return d(r)&&L(r).exists(function(t){return q(t,"block")})},kt=function(t){return 0===t.start.length},Ot=function(t,n){var r=C.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===ut(t)?r.orThunk(function(){return C.some(t.getBody())}):r},wt=mt.DOM,Ct=function(t){return function(n){return t===n?-1:0}},Rt=function(t){return function(n){return t.isBlock(n)||T(["BR","IMG","HR","INPUT"],n.nodeName)||"false"===t.getContentEditable(n)}},Et=function(t,n,r){if(vt(t)&&n>=0)return C.some(pt(t,n));var e=gt(wt);return C.from(e.backwards(t,n,Ct(t),r)).map(function(t){return pt(t.container,t.container.data.length)})},xt=function(t,n,r){if(vt(t)&&n>=t.length)return C.some(pt(t,n));var e=gt(wt);return C.from(e.forwards(t,n,Ct(t),r)).map(function(t){return pt(t.container,0)})},Tt=function(t,n,r){if(!vt(t))return C.none();var e=t.textContent;if(n>=0&&n<=e.length)return C.some(pt(t,n));var o=gt(wt);return C.from(o.backwards(t,n,Ct(t),r)).bind(function(t){var e=t.container.data;return Tt(t.container,n+e.length,r)})},Pt=function(t,n,r){if(!vt(t))return C.none();var e=t.textContent;if(n<=e.length)return C.some(pt(t,n));var o=gt(wt);return C.from(o.forwards(t,n,Ct(t),r)).bind(function(t){return Pt(t.container,n-e.length,r)})},Nt=function(t,n,r,e,o){var a=gt(t,Rt(t));return C.from(a.backwards(n,r,e,o))},St=function(t,n,r){if(vt(n)&&(r<0||r>n.data.length))return[];for(var e=[r],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){e.push(i);break}o=a}return o===t?e.reverse():[]},At=function(t,n,r,e,o){var a=St(t,n,r),i=St(t,e,o);return{start:a,end:i}},Bt=function(t,n){var r=n.slice(),e=r.pop(),o=D(r,function(t,n){return t.bind(function(t){return C.from(t.childNodes[n])})},C.some(t));return o.bind(function(t){return vt(t)&&(e<0||e>t.data.length)?C.none():C.some({node:t,offset:e})})},Dt=function(t,n){return Bt(t,n.start).bind(function(r){var e=r.node,o=r.offset;return Bt(t,n.end).map(function(t){var n=t.node,r=t.offset,a=document.createRange();return a.setStart(e,o),a.setEnd(n,r),a})})},It=function(t,n){return At(t,n.startContainer,n.startOffset,n.endContainer,n.endOffset)},Mt=function(t,n,r){var e=xt(n,0,n);e.each(function(e){var o=e.container;Pt(o,r.start.length,n).each(function(r){var e=t.createRng();e.setStart(o,0),e.setEnd(r.container,r.offset),yt(t,e,function(t){return t===n})})})},jt=function(t,n){var r=t.dom,e=n.pattern,o=Dt(r.getRoot(),n.range).getOrDie("Unable to resolve path range");return Ot(t,o).each(function(n){"block-format"===e.type?bt(e.format,t.formatter)&&t.undoReceptionist.transact(function(){Mt(t.dom,n,e),t.formatter.apply(e.format)}):"block-command"===e.type&&t.undoReceptionist.transact(function(){Mt(t.dom,n,e),t.execCommand(e.cmd,!1,e.value)})}),!0},_t=function(t,n){var r=n.replace(lt," ");return M(t,function(t){return 0===n.indexOf(t.start)||0===r.indexOf(t.start)})},Ut=function(t,n){var r=t.dom,e=t.selection.getRng();return Ot(t,e).filter(function(n){var e=ut(t),o=""===e&&r.is(n,"body")||r.is(n,e);return null!==n&&o}).bind(function(t){var e=t.textContent,o=_t(n,e);return o.map(function(n){return dt.trim(e).length===n.start.length?[]:[{pattern:n,range:At(r.getRoot(),t,0,t,0)}]})}).getOr([])},Lt=function(t,n){if(0!==n.length){var r=t.selection.getBookmark();N(n,function(n){return jt(t,n)}),t.selection.moveToBookmark(r)}},Vt=0,Wt=function(t){var n=new Date,r=n.getTime(),e=Math.floor(1e9*Math.random());return Vt++,t+"_"+e+Vt+String(r)},qt=function(t,n,r){return""===n||t.length>=n.length&&t.substr(r,r+n.length)===n},Ft=function(t,n){return qt(t,n,t.length-n.length)},Gt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},Ht=function(t,n){var r=t.createRng();return r.setStartAfter(n.start),r.setEndBefore(n.end),r},Jt=function(t,n,r){var e=Dt(t.getRoot(),r).getOrDie("Unable to resolve path range"),o=e.startContainer,a=e.endContainer,i=0===e.endOffset?a:a.splitText(e.endOffset),u=0===e.startOffset?o:o.splitText(e.startOffset);return{prefix:n,end:i.parentNode.insertBefore(Gt(t,n+"-end"),i),start:u.parentNode.insertBefore(Gt(t,n+"-start"),u)}},Kt=function(t,n,r){ht(t,t.get(n.prefix+"-end"),r),ht(t,t.get(n.prefix+"-start"),r)},Xt=function(t,n,r){return function(t,n){var e=t.data,o=e.substring(0,n),a=o.lastIndexOf(r.charAt(r.length-1)),i=o.lastIndexOf(r);return-1!==i?i+r.length:-1!==a?a+1:-1}},zt=function(t,n,r,e){var o=n.start,a=Nt(t,e.container,e.offset,Xt(t,r,o),r);return a.bind(function(e){if(e.offset>=o.length){var a=t.createRng();return a.setStart(e.container,e.offset-o.length),a.setEnd(e.container,e.offset),C.some(a)}var i=e.offset-o.length;return Tt(e.container,i,r).map(function(n){var r=t.createRng();return r.setStart(n.container,n.offset),r.setEnd(e.container,e.offset),r}).filter(function(t){return t.toString()===o}).orThunk(function(){return zt(t,n,r,pt(e.container,0))})})},Qt=function(t,n,r,e,o,a){if(void 0===a&&(a=!1),0===n.start.length&&!a){var i=t.createRng();return i.setStart(r,e),i.setEnd(r,e),C.some(i)}return Et(r,e,o).bind(function(r){var e=zt(t,n,o,r);return e.bind(function(t){if(a){if(t.endContainer===r.container&&t.endOffset===r.offset)return C.none();if(0===r.offset&&t.endContainer.textContent.length===t.endOffset)return C.none()}return C.some(t)})})},Yt=function(t,n,r){var e=t.dom,o=e.getRoot(),a=r.pattern,i=r.position.container,u=r.position.offset;return Tt(i,u-r.pattern.end.length,n).bind(function(f){var c=At(o,f.container,f.offset,i,u);if(kt(a))return C.some({matches:[{pattern:a,startRng:c,endRng:c}],position:f});var s=Zt(t,r.remainingPatterns,f.container,f.offset,n),l=s.getOr({matches:[],position:f}),d=l.position,m=Qt(e,a,d.container,d.offset,n,s.isNone());return m.map(function(t){var n=It(o,t);return{matches:l.matches.concat([{pattern:a,startRng:n,endRng:c}]),position:pt(t.startContainer,t.startOffset)}})})},Zt=function(t,n,r,e,o){var a=t.dom;return Et(r,e,a.getRoot()).bind(function(i){var u=a.createRng();u.setStart(o,0),u.setEnd(r,e);for(var f=u.toString(),c=0;c<n.length;c++){var s=n[c];if(Ft(f,s.end)){var l=n.slice();l.splice(c,1);var d=Yt(t,o,{pattern:s,remainingPatterns:l,position:i});if(d.isSome())return d}}return C.none()})},$t=function(t,n,r){t.selection.setRng(r),"inline-format"===n.type?N(n.format,function(n){t.formatter.apply(n)}):t.execCommand(n.cmd,!1,n.value)},tn=function(t,n,r,e){var o=Ht(t.dom,r);yt(t.dom,o,e),$t(t,n,o)},nn=function(t,n,r,e,o){var a=t.dom,i=Ht(a,e),u=Ht(a,r);yt(a,u,o),yt(a,i,o);var f={prefix:r.prefix,start:r.end,end:e.start},c=Ht(a,f);$t(t,n,c)},rn=function(t,n){var r=Wt("mce_textpattern"),e=B(n,function(n,e){var o=Jt(t,r+"_end"+n.length,e.endRng);return n.concat([u(u({},e),{endMarker:o})])},[]);return B(e,function(n,o){var a=e.length-n.length-1,i=kt(o.pattern)?o.endMarker:Jt(t,r+"_start"+a,o.startRng);return n.concat([u(u({},o),{startMarker:i})])},[])},en=function(t,n,r){var e=t.selection.getRng();return!1===e.collapsed?[]:Ot(t,e).bind(function(o){var a=e.startOffset-(r?1:0);return Zt(t,n,e.startContainer,a,o)}).fold(function(){return[]},function(t){return t.matches})},on=function(t,n){if(0!==n.length){var r=t.dom,e=t.selection.getBookmark(),o=rn(r,n);N(o,function(n){var e=r.getParent(n.startMarker.start,r.isBlock),o=function(t){return t===e};kt(n.pattern)?tn(t,n.pattern,n.endMarker,o):nn(t,n.pattern,n.startMarker,n.endMarker,o),Kt(r,n.endMarker,o),Kt(r,n.startMarker,o)}),t.selection.moveToBookmark(e)}},an=function(t,n){if(!t.selection.isCollapsed())return!1;var r=en(t,n.inlinePatterns,!1),e=Ut(t,n.blockPatterns);return(e.length>0||r.length>0)&&(t.undoReceptionist.add(),t.undoReceptionist.extra(function(){t.execCommand("mceInsertNewLine")},function(){t.insertContent(st),on(t,r),Lt(t,e);var n=t.selection.getRng(),o=Et(n.startContainer,n.startOffset,t.dom.getRoot());t.execCommand("mceInsertNewLine"),o.each(function(n){var r=n.container;r.data.charAt(n.offset-1)===st&&(r.deleteData(n.offset-1,1),ht(t.dom,r.parentNode,function(n){return n===t.dom.getRoot()}))})}),!0)},un=function(t,n){var r=en(t,n.inlinePatterns,!0);r.length>0&&t.undoReceptionist.transact(function(){on(t,r)})},fn=function(t,n,r){for(var e=0;e<t.length;e++)if(r(t[e],n))return!0;return!1},cn=function(t,n){return fn(t,n,function(t,n){return t===n.keyCode&&!1===ct.modifierPressed(n)})},sn=function(t,n){return fn(t,n,function(t,n){return t.charCodeAt(0)===n.charCode})},ln=function(t,n){var r=[",",".",";",":","!","?"],e=[32];t.on("keydown",function(r){13!==r.keyCode||ct.modifierPressed(r)||an(t,n.get())&&r.preventDefault()},!0),t.on("keyup",function(r){cn(e,r)&&un(t,n.get())}),t.on("keypress",function(e){sn(r,e)&&ft.setEditorTimeout(t,function(){un(t,n.get())})})};n()})();