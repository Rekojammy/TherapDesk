(function(){"use strict";function t(){n.add("autolink",function(t){S(t)})}var n=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),e=function(t,n,e){return""===n||t.length>=n.length&&t.substr(e,e+n.length)===n},i=function(t,n){return-1!==t.indexOf(n)},r=function(t,n){return e(t,n,0)},o=tinymce.util.Tools.resolve("tinymce.Env"),f=function(){return/(?:[A-Za-z][A-Za-z\d.+-]{0,14}:\/\/(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?|www\.|[-;:&=+$,.\w]+@)[A-Za-z\d-]+(?:\.[A-Za-z\d-]+)*(?::\d+)?(?:\/(?:[-+~=.,%()\/\w]*[-+~=%()\/\w])?)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g},u=new RegExp("^"+f().source+"$","i"),a=function(t){return t.getParam("autolink_pattern",u)},c=function(t){return t.getParam("default_link_target",!1)},s=function(t){return t.getParam("link_default_protocol","http","string")},d=function(t){return/^[(\[{ \u00a0]$/.test(t)},l=function(t){return 3===t.nodeType},g=function(t){return 1===t.nodeType},h=function(t){return A(t,-1)},C=function(t){return A(t,0)},m=function(t){return A(t,-1)},k=function(t,n){if(n<0&&(n=0),l(t)){var e=t.data.length;n>e&&(n=e)}return n},w=function(t,n,e){!g(n)||n.hasChildNodes()?t.setStart(n,k(n,e)):t.setStartBefore(n)},y=function(t,n,e){!g(n)||n.hasChildNodes()?t.setEnd(n,k(n,e)):t.setEndAfter(n)},v=function(t){return/^([A-Za-z][A-Za-z\d.+-]*:\/\/)|mailto:/.test(t)},p=function(t){return/[?!,.;:]/.test(t)},A=function(t,n){var e,o,f,u,g,h,C,m=a(t),k=c(t);if(null===t.dom.getParent(t.selection.getNode(),"a[href]")){var A=t.selection.getRng().cloneRange();if(A.startOffset<5){if(g=A.endContainer.previousSibling,!g){if(!A.endContainer.firstChild||!A.endContainer.firstChild.nextSibling)return;g=A.endContainer.firstChild.nextSibling}if(h=g.length,w(A,g,h),y(A,g,h),A.endOffset<5)return;e=A.endOffset,o=g}else{if(o=A.endContainer,!l(o)&&o.firstChild){for(;!l(o)&&o.firstChild;)o=o.firstChild;l(o)&&(w(A,o,0),y(A,o,o.nodeValue.length))}e=1===A.endOffset?2:A.endOffset-1-n}var S=e;do{w(A,o,e>=2?e-2:0),y(A,o,e>=1?e-1:0),e-=1,C=A.toString()}while(!d(C)&&e-2>=0);d(A.toString())?(w(A,o,e),y(A,o,S),e+=1):0===A.startOffset?(w(A,o,0),y(A,o,S)):(w(A,o,e),y(A,o,S)),u=A.toString(),p(u.charAt(u.length-1))&&y(A,o,S-1),u=A.toString().trim();var O=u.match(m),b=s(t);if(O){var x=O[0];r(x,"www.")?x=b+"://"+x:i(x,"@")&&!v(x)&&(x="mailto:"+x),f=t.selection.getBookmark(),t.selection.setRng(A),t.execCommand("createlink",!1,x),!1!==k&&t.dom.setAttrib(t.selection.getNode(),"target",k),t.selection.moveToBookmark(f),t.nodeChanged()}}},S=function(t){var n;t.on("keydown",function(n){if(13===n.keyCode)return m(t)}),o.browser.isIE()?t.on("focus",function(){if(!n){n=!0;try{t.execCommand("AutoUrlDetect",!1,!0)}catch(t){}}}):(t.on("keypress",function(n){if(41===n.keyCode||93===n.keyCode||125===n.keyCode)return h(t)}),t.on("keyup",function(n){if(32===n.keyCode)return C(t)}))};t()})();