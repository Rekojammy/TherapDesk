(function(){"use strict";function n(){o.add("emoticons",function(n,t){var e=G(n,t),r=H(n),o=Y(n,e,r);en(n,o),un(n),on(n,o),rn(n)})}var t,e,r,o=tinymce.util.Tools.resolve("tinymce.PluginReceptionist"),i=function(n){return function(t){return n===t}},u=i(null),c=function(){},a=function(n){return function(){return n}},l=function(n){return n},s=a(!1),f=a(!0),m=function(){return g},g=(t=function(n){return n()},e=l,r={fold:function(n,t){return n()},isSome:s,isNone:f,getOr:e,getOrThunk:t,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:a(null),getOrUndefined:a(void 0),or:e,orThunk:t,map:m,each:c,bind:m,exists:s,forall:f,filter:function(){return m()},toArray:function(){return[]},toString:a("none()")},r),d=function(n){var t=a(n),e=function(){return o},r=function(t){return t(n)},o={fold:function(t,e){return e(n)},isSome:f,isNone:s,getOr:t,getOrThunk:t,getOrDie:t,getOrNull:t,getOrUndefined:t,or:e,orThunk:e,map:function(t){return d(t(n))},each:function(t){t(n)},bind:r,exists:r,forall:r,filter:function(t){return t(n)?o:g},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},v=function(n){return null==n?g:d(n)},h={some:d,none:m,from:v},y=function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];if(t(o,e))return!0}return!1},p=function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r},b=function(n,t){for(var e=0,r=n.length;e<r;e++){var o=n[e];t(o,e)}},w=function(n){var t=n,e=function(){return t},r=function(n){t=n};return{get:e,set:r}},O=function(n,t){var e=null,r=function(){u(e)||(clearTimeout(e),e=null)},o=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];r(),e=setTimeout(function(){e=null,n.apply(null,o)},t)};return{cancel:r,throttle:o}},C=function(n,t){n.insertContent(t)},k=function(){return k=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e],t)Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},k.apply(this,arguments)},j=Object.keys,A=Object.hasOwnProperty,_=function(n,t){for(var e=j(n),r=0,o=e.length;r<o;r++){var i=e[r],u=n[i];t(u,i)}},T=function(n,t){return x(n,function(n,e){return{k:e,v:t(n,e)}})},x=function(n,t){var e={};return _(n,function(n,r){var o=t(n,r);e[o.k]=o.v}),e},P=function(n,t){return A.call(n,t)},D=function(n,t){return t},S=function(n){return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<t.length;o++){var i=t[o];for(var u in i)P(i,u)&&(r[u]=n(r[u],i[u]))}return r}},L=S(D),E=function(n){var t=w(h.none()),e=function(){return t.get().each(n)},r=function(){e(),t.set(h.none())},o=function(){return t.get().isSome()},i=function(){return t.get()},u=function(n){e(),t.set(h.some(n))};return{clear:r,isSet:o,get:i,set:u}},F=function(){var n=E(c),t=function(t){return n.get().each(t)};return k(k({},n),{on:t})},N=function(n,t,e){return""===t||n.length>=t.length&&n.substr(e,e+t.length)===t},I=function(n,t){return-1!==n.indexOf(t)},R=function(n,t){return N(n,t,0)},z=tinymce.util.Tools.resolve("tinymce.Resource"),U=tinymce.util.Tools.resolve("tinymce.util.Delay"),B=tinymce.util.Tools.resolve("tinymce.util.Promise"),M="tinymce.plugins.emoticons",q=function(n){return n.getParam("emoticons_database","emojis","string")},G=function(n,t){var e=q(n);return n.getParam("emoticons_database_url",t+"/js/"+e+n.suffix+".js","string")},H=function(n){return n.getParam("emoticons_database_id",M,"string")},J=function(n){return n.getParam("emoticons_append",{},"object")},K=function(n){return n.getParam("emoticons_images_url","https://twemoji.maxcdn.com/v/13.0.1/72x72/","string")},Q="All",V={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},W=function(n,t){return P(n,t)?n[t]:t},X=function(n){var t=J(n);return T(t,function(n){return k({keywords:[],category:"user"},n)})},Y=function(n,t,e){var r=F(),o=F(),i=K(n),u=function(n){return R(n.char,"<img")?n.char.replace(/src="([^"]+)"/,function(n,t){return'src="'+i+t+'"'}):n.char},c=function(n){var t={},e=[];_(n,function(n,r){var o={title:r,keywords:n.keywords,char:u(n),category:W(V,n.category)},i=void 0!==t[o.category]?t[o.category]:[];t[o.category]=i.concat([o]),e.push(o)}),r.set(t),o.set(e)};n.on("init",function(){z.load(e,t).then(function(t){var e=X(n);c(L(t,e))},function(n){console.log("Failed to load emoticons: "+n),r.set({}),o.set([])})});var a=function(n){return n===Q?l():r.get().bind(function(t){return h.from(t[n])}).getOr([])},l=function(){return o.get().getOr([])},s=function(){return[Q].concat(j(r.get().getOr({})))},f=function(){return m()?B.resolve(!0):new B(function(n,e){var r=15,o=U.setInterval(function(){m()?(U.clearInterval(o),n(!0)):(r--,r<0&&(console.log("Could not load emojis from url: "+t),U.clearInterval(o),e(!1)))},100)})},m=function(){return r.isSet()&&o.isSet()};return{listCategories:s,hasLoaded:m,waitForLoad:f,listAll:l,listCategory:a}},Z=function(n,t){return I(n.title.toLowerCase(),t)||y(n.keywords,function(n){return I(n.toLowerCase(),t)})},$=function(n,t,e){for(var r=[],o=t.toLowerCase(),i=e.fold(function(){return s},function(n){return function(t){return t>=n}}),u=0;u<n.length&&(0!==t.length&&!Z(n[u],o)||(r.push({value:n[u].char,text:n[u].title,icon:n[u].char}),!i(r.length)));u++);return r},nn="pattern",tn=function(n,t){var e={pattern:"",results:$(t.listAll(),"",h.some(300))},r=w(Q),o=function(n){var e=n.getData(),o=r.get(),i=t.listCategory(o),u=$(i,e[nn],o===Q?h.some(300):h.none());n.setData({results:u})},i=O(function(n){o(n)},200),u={label:"Search",type:"input",name:nn},c={type:"collection",name:"results"},a=function(){var o={type:"tabpanel",tabs:p(t.listCategories(),function(n){return{title:n,name:n,items:[u,c]}})};return{title:"Emoticons",size:"normal",body:o,initialData:e,onTabChange:function(n,t){r.set(t.newTabName),i.throttle(n)},onChange:i.throttle,onAction:function(t,e){"results"===e.name&&(C(n,e.value),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}},l=n.windowReceptionist.open(a());l.focus(nn),t.hasLoaded()||(l.block("Loading emoticons..."),t.waitForLoad().then(function(){l.redial(a()),i.throttle(l),l.focus(nn),l.unblock()}).catch(function(n){l.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),l.focus(nn),l.unblock()}))},en=function(n,t){n.addCommand("mceEmoticons",function(){return tn(n,t)})},rn=function(n){n.on("PreInit",function(){n.parser.addAttributeFilter("data-emoticon",function(n){b(n,function(n){n.attr("data-mce-resize","false"),n.attr("data-mce-placeholder","1")})})})},on=function(n,t){n.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(n,e){return t.waitForLoad().then(function(){var r=t.listAll();return $(r,n,h.some(e))})},onAction:function(t,e,r){n.selection.setRng(e),n.insertContent(r),t.hide()}})},un=function(n){var t=function(){return n.execCommand("mceEmoticons")};n.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:t}),n.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:t})};n()})();